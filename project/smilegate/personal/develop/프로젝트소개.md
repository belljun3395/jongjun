## 프로젝트 소개

스마일 게이트 2022 윈터캠프 1인프로젝트 과제 중 **인증 서버**를 선택하여 구현한 인증 서버다.

현재 디렉토리 구조는 아래와 같다.

```
sgdevcamp_auth
|- back
|---- auth
|---- group
|---- notification
|- front
|- infra
|---- config
|---- eureka-server
|---- zuul
```



해당 파일에서는 전체 서비스의 아키텍쳐와 각 디렉토리별 간략한 소개를 할 것이고 자세한 기능들에 대한 소개는 별도의 파일을 통해 기술하겠다.



### 기술 스택

- Java 11
- Springboot 2.1.0.RELEASE
- Spring Cloud Starter Netflix Zuul
- Spring Cloud Netflix Eureka
- Spring Cloud Starter Open Feign
- Springboot Starter mail
- Jwt
- Mysql
- kafka



### 전체 아키텍쳐

![전체서비스아키텍쳐](https://user-images.githubusercontent.com/102807742/212077823-d71ef7b6-a822-491b-9a53-bef548890eef.png)

전체 아키텍쳐에서 눈에 띄는 부분은 **Neflix Eureka, Zuul** 그리고 **kafka**일 것이라 생각한다.



우선 Netfilx 오픈 소스를 사용한 이유는 해당 프로젝트가 <u>MSA를 염두한 프로젝트</u>이기 때문이다.

현시점(2022.1.12)에서는 아직 MSA는 아니다.

그렇게 제가 이야기할 수 있는 이유는 현재는 Zuul과 Eureka를 사용해 다른 서비스 라우팅과 인증 로깅 정도만 수행하고 있기 때문이다.



제가 생각하는 MSA의 핵심은 <u>장애 전파 억제</u> 그리고 <u>서비스간 의존성 제거</u>다.

그리고 단순히 MSA를 정의하면 마이크로 서비스라는 비지니스 로직을 조합하는 컨트롤러다.

이러한 MSA를 제대로 구현하려면 각 서비스의 요청에 대해 파악하고 이를 바탕으로 장애 전파를 막기 위한 조치를 하여야 한다고 생각한다.

하지만 아직 프로젝트가 완전히 완성되었다고 생각하지 않고 구체적으로 서비스를 어떻게 파악하여야 하는지 기반 지식이 부족하다.

지금 알고 있는 것은 circuit breaker를 통해 장애 전파를 막는다고 하는데 이를 설정할 때 필요한 서비스별 타임아웃을 시간을 파악하는데 아직 공부가 더 필요하다.

이부분에 대해서는 추후 공부한 이후 구현해볼 예정이다.

추후 구현할 기능은 다음과 같다.

+ nGrinder을 통한 적절한 타임아웃 파악후 **타임아웃 설정**
+ 단순 라우팅이 아닌 조합을 통해 **컨트롤러 역할 구현**



Kafka를 사용한 이유는 다음과 같다.

해당 프로젝트에는 유저의 Role이 member 그리고 admin으로 2가지다.

기본적으로 가입을 하게 되면 member로 가입되고 admin이 되기 위해서는 email 인증이 필요하다.

이 email 인증을 수행할 때 kafka를 사용한다.

우선 email을 보내는 기능은 notification에 존재한다.

이를 분리 시킨 이유는 notification에 지금은 email을 보내는 서비스 하나 밖에 없지만 sms를 보내는 서비스와 같이 다른 알림 서비스로 그 서비스를 확장할 수 있기 때문에 별도의 서버로 분리시켰다.

그렇기에 email을 보내는 것을 kafka로 비동기적으로 처리하지 않는다면 email을 보내는 과정을 모두 수행한 다음 응답을 하게 된다.

이는 불필요한 시간 소요라고 생각하여 Kafka로 비동기적으로 처리하게 되었다.

